<!DOCTYPE html>
<html>
<head>
    <title>Detecci칩n de caras en local</title>
</head>
<body>
    <h1>Detenci칩n de caras en local</h1>
    <video id="videoElement" width="640" height="480" autoplay></video>
    <canvas id="canvas" width="640" height="480" style="position: absolute; top: 0; left: 0;"></canvas>

    <script src="face-api.min.js"></script>
    <script>
        async function setupCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });

                const videoElement = document.getElementById('videoElement');
                videoElement.srcObject = stream;

                return new Promise(resolve => {
                    videoElement.onloadedmetadata = () => {
                        resolve(videoElement);
                    };
                });
            } else {
                console.error('La API getUserMedia no est치 soportada en este navegador.');
            }
        }

        async function detectFaces() {
            await faceapi.nets.tinyFaceDetector.loadFromUri('./weights');
            await faceapi.nets.faceLandmark68Net.loadFromUri('./weights');

            const videoElement = await setupCamera();

            const canvas = document.getElementById('canvas');

            videoElement.addEventListener('play', () => {
                const displaySize = { width: videoElement.width, height: videoElement.height };
                faceapi.matchDimensions(canvas, displaySize);

                setInterval(async () => {
                    const detections = await faceapi.detectAllFaces(videoElement,
                        new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks();

                    const resizedDetections = faceapi.resizeResults(detections, displaySize);
                    canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);

                    if (resizedDetections.length > 0) {
                        const face = resizedDetections[0].alignedRect.box;
                        const x = face.x - (face.width * 0.1);
                        const y = face.y - (face.height * 0.1);
                        const width = face.width * 1.2;
                        const height = face.height * 1.2;
                        canvas.getContext('2d').drawRect(x, y, width, height);
                    }
                }, 100); // Cada 100 ms, actualiza la detecci칩n de caras y el marco.
            });
        }

        detectFaces().catch(error => console.error('Error al cargar el modelo:', error));
    </script>
</body>
</html>